# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Classes**

* [`sap`](#sap): Installs prerequisites for an SAP environment on RedHat derivatives
* [`sap::cluster`](#sapcluster): Configures a node with the appropriate SAP cluster resources
* [`sap::cluster::prepare`](#sapclusterprepare): Ensure local SAP configuration is ready for a clustered environment
* [`sap::config`](#sapconfig): Private class used to control configuration file deployment.
* [`sap::config::common`](#sapconfigcommon): Trick SAP into thinking this host is running a supported RHEL
* [`sap::config::limits`](#sapconfiglimits): Generates an etc limits file for each relevant enabled component.
* [`sap::config::mount_points`](#sapconfigmount_points): Creates and manages mountpoints relevant to each instance type.
* [`sap::config::router`](#sapconfigrouter): Class: sap::config::router  This class contain the configuration for SAP Router  Parameters:   This module has no parameters  Actions:      T
* [`sap::config::sysctl`](#sapconfigsysctl): Configures sysctl parameters for the selected components.
* [`sap::config::tmpfs`](#sapconfigtmpfs): Ensures that the tmpfs partition is configured per SAP recommendations Add swap space check per
* [`sap::install`](#sapinstall): Installs the packages associated with the selected sets
* [`sap::install::mount_dependencies`](#sapinstallmount_dependencies): Installs dependent modules needed for mount points
* [`sap::params`](#sapparams): This module contains the parameters for SAP Netweaver
* [`sap::service`](#sapservice): Class: sap::service  This class contain the service configuration for SAP Netweaver  Parameters:   This class has no parameters  Actions:    
* [`sap::service::cloudconnector`](#sapservicecloudconnector): Class: sap::service::cloudconnector  This module contain the service configuration for SAP Cloud Connector  Parameters:   This module has no 
* [`sap::service::router`](#sapservicerouter): Class: sap::service::router  This module contain the service configuration for SAP Router  Parameters:   This module has no parameters  Actio

**Defined types**

* [`sap::config::mount_point`](#sapconfigmount_point): 
* [`sap::install::package_set`](#sapinstallpackage_set): Manages the installation of a package set

**Functions**

* [`sap::sysctl_calculated_values`](#sapsysctl_calculated_values): Recursive function used to compute the value for a sysctl var.
* [`sap::sysctl_line`](#sapsysctl_line): This function converts a sysctl entry hash into a string line.

## Classes

### sap

This module manages SAP prerequisites for several types of SAP installations
based on corresponding SAP OSS notes

Copyright 2016 Thomas Bendler

#### Examples

##### Application server containing an ADS instance and a Netweaver instance

```puppet
class { 'sap':
  system_ids         => ['AP0', 'AP1'],
  enabled_components => ['base', 'base_extended', 'ads'],
}
```

#### Parameters

The following parameters are available in the `sap` class.

##### `system_ids`

Data type: `Array[Sap::SID]`

]
An array of SAP system IDs (SIDs) which will be present on the target host.
Note that each entry must be exactly 3 characters in length and contain
exclusively uppercase characters.

Default value: []

##### `enabled_components`

Data type: `Array[Sap::SapComponents]`

List of components which will be present on the target system. Note that
this is an enum which includes the following valid options:
* `base`: SAP ABAP, JAVA stack, SAP ADS or SAP BO is used
* `base_extended`: ADS, Business Objects, and HANA require this
* `experimental`: needed for special features like SAP router
* `ads`: Adobe Document Services has additional requirements
* `bo`: Business Objects has other additional requirements
* `cloudconnector`: SAP Cloud Connector
* `router`: Configures the SAP router service on this machine

Default value: ['base']

##### `create_mount_points`

Data type: `Boolean`

Indicates whether the standard mount points should be created for the
specified instance.

Default value: `false`

##### `mount_points`

Data type: `Hash[Enum['common', 'base', 'db2'], Hash]`

Defines the mount points and supporting directories which should be created
for each component type. Note that this structure is a deep hash with a `--`
knockout value.

Default value: {}

##### `router_oss_realm`

Data type: `Optional[String]`

Specify OSS realm for SAP router connection. For example,
`'p:CN=hostname.domain.tld, OU=0123456789, OU=SAProuter, O=SAP, C=DE'`

Default value: `undef`

##### `manage_mount_dependencies`

Data type: `Boolean`

When enabled this module will install and configure the puppet-nfs module
detailed here: https://forge.puppet.com/derdanne/nfs
Note that currently only NFSv4 is supported for clients.

Default value: `false`

##### `router_rules`

Data type: `Optional[Array[String]]`

Specify array of rules for the SAP router

Default value: `undef`

##### `distro_text`

Data type: `Optional[String]`

Modify text in /etc/redhat-release

Default value: `undef`

##### `backend_database`

Data type: `Array[Sap::BackendDatabase]`

List of backend database types this SAP instance will connect to. Note that
multiple backends are possible for systems such as SCM which connect to both
a standard backend (e.g. Oracle/DB2) and LiveCache. Note that this field is
mandatory if the 'base' component is enabled on a node.

##### `backend_databases`

Data type: `Array[Sap::BackendDatabase]`



Default value: []

### sap::cluster

Configures a node with the appropriate SAP cluster resources

#### Parameters

The following parameters are available in the `sap::cluster` class.

##### `rules`

Data type: `Sap::SIDClusterData`



Default value: {}

### sap::cluster::prepare

Simple class which prepares the config files on this machine for a
high-availability configuration of SAP. There are currently two components to
this process: 1) the profile files in /sapmnt/<SID> corresponding to this
machine are updated replacing entries for Restart_Program with Start_Program.
2) All `.sapenv_${HOSTNAME}.(sh|csh)` and other similar host-specific profile
files are removed so the system will only use the `.sapenv.(sh|csh)` variants.

Configuration is performed entirely based on the values of local 'sap' facts.

#### Parameters

The following parameters are available in the `sap::cluster::prepare` class.

##### `packages`

Data type: `Optional[Array[String]]`

Ensures that the resource agents needed for SAP configuration are installed
on this system. Note that defaults are provided only for RHEL 7 derivatives.

Default value: []

### sap::config

Orchestrates the creation of relevant configuration files needed by SAP

### sap::config::common

Overwrites the distro text file to trick SAP into thinking this is RHEL.

### sap::config::limits

This class uses data from hiera to generate an etc limits file for each
enabled component. Note that some components do not specify limits while
others may have SID specific data which will result in a more complicated
limit output

### sap::config::mount_points

Creates and manages mountpoints relevant to each instance type.

### sap::config::router

Class: sap::config::router

This class contain the configuration for SAP Router

Parameters:   This module has no parameters

Actions:      This module has no actions

Requires:     This module has no requirements

Sample Usage: include sap_router::config

### sap::config::sysctl

This class configures the sysctl parameters based on the values
provided in sap::param::config_sysctl for each enabled component

### sap::config::tmpfs

Ensures that the tmpfs partition is configured per SAP recommendations
Add swap space check per

### sap::install

Packages are installed based on the selections provided to the main sap class
using sane defaults configured in hiera.

### sap::install::mount_dependencies

When enabled this ensures that all necessary dependencies for mount point
management are installed

### sap::params

General parameter definitions for the SAP Netweaver environment are defined
within this module. Note that OS and Architecture specific variants are
actually pulled from defaults in Hiera.

#### Parameters

The following parameters are available in the `sap::params` class.

##### `packages_common`

Data type: `Array[String]`

A complete list of packages common to all distros. This is primarily uuidd,
however, it also includes the package sets that sapconf would deploy.

Default value: []

##### `packages_base`

Data type: `Array[String]`

These packages should be relevant to any SAP Netweaver machine.

Default value: []

##### `packages_base_extended`

Data type: `Array[String]`

ADS, Business Objects, and HANA (1.0?) systems need these packages in
addition to the base set.

Default value: []

##### `packages_ads`

Data type: `Array[String]`

Special packages uniquely required by ADS

Default value: []

##### `packages_bo`

Data type: `Array[String]`

Special packages that Business Objects depends on.

Default value: []

##### `packages_hana`

Data type: `Array[String]`

Special packages that HANA (1.0?) depends on.

Default value: []

##### `packages_cloudconnector`

Data type: `Array[String]`

SAP Cloud Connector depends on a small set of SAP specific packages. These
appear to be SAP created. (Or they come from some other weird place).

Default value: []

##### `packages_saprouter`

Data type: `Array[String]`

This specifies the package to install SAP Router on a given system.

Default value: []

##### `packages_experimental`

Data type: `Array[String]`

Special SAP tools and utilities including sapcar and others... Appears to be
custom built?

Default value: []

##### `packages_db2`

Data type: `Array[String]`

Extra DB2 package requirements which are included on a per OS basis.

Default value: []

##### `config_redhat_release_conf`

Data type: `String`

This should point to the path of the desired redhat release config file.

Default value: `undef`

##### `service_uuidd`

Data type: `String`

Name of the uuidd service. This is used to enable the daemon after the
installation completes.

Default value: `undef`

##### `service_scc`

Data type: `String`

SAP Cloud Connector service name used for enabling the service.

Default value: `undef`

##### `service_saprouter`

Data type: `String`

Name of the service corresponding to the SAP router process.

Default value: `undef`

##### `config_saproutetab`

Data type: `String`

File target for the sap router route-table should it be configure.

Default value: `undef`

##### `config_saproutetab_template`

Data type: `String`

Path within the module to the appropriate erb template to apply for the
saproutetab.

Default value: `undef`

##### `config_saprouter_sysconfig`

Data type: `String`

Target /etc/sysconfig file for the saprouter service

Default value: `undef`

##### `config_saprouter_sysconfig_template`

Data type: `String`

Embedded ruby template to be applied to the sysconfig file

Default value: `undef`

##### `config_saprouter_sysconfig_template`

Data type: `String`

Embedded ruby template to be applied to the sysconfig file

Default value: `undef`

##### `config_sysctl`

Data type: `Hash[
    String,
    Hash[
      String,
      Variant[
        String,
        Integer,
        Array[String],
        Hash[
          String,
          Variant[
            Hash[
              String,
              Variant[
                String,
                Integer,
                Array[
                  Variant[
                    String,
                    Hash[
                      String,
                      Variant[
                        String,
                        Integer,
                      ]
                    ],
                  ]
                ]
              ]
            ]
          ]
        ]
      ]
    ]
  ]`

Similar to config_limits this provides a configurable set of directives to
include in /etc/sysctl.d/ on a per component basis.

Default value: {}

##### `config_limits`

Data type: `Hash[
    String,
    Hash[
      String,
      Variant[
        String,
        Boolean,
        Array[String],
        Hash[
          String,
          Hash[
            String,
            Hash[
              String,
              Variant[
                String,
                Integer,
              ]
            ]
          ]
        ]
      ]
    ]
  ]`

A deeply nested hash containing the target /etc/security/limits.d/
entries for a given system. This is currently defined for baseline sap
instances and db2. The hash has the following structure

```puppet
'component-name' => {
  path           => '/etc/security/limits.d', # this should be left alone - limits directory
  sequence       => '00', # string ID prepended to the limits file. e.g.
                          # /etc/security/limits.d/00-sap-base.conf
  per_sid        => true, # Indicates whether the domain has a _sid_
                          # substring that will need to be substituted with the actual system ID.
  header_comment => [ # An array of comment lines which will appear at the
                      #start of the file
    'Comment line 1',
    'Comment line 2',
  ],
  entries => { # Hash containing the actual
  }
```

Default value: {}

##### `config_default_mount_options`

Data type: `Hash[
    String,
    Hash[
      String,
      String,
    ]
  ]`

Default options to provide to provide for the mount operation in the case
that they are not overridden locally. See
https://puppet.com/docs/puppet/latest/types/mount.html#mount-attribute-options
for details. Note that this is a hash of hashes with an entry for each
supported resource type.

Default value: {}

##### `config_sid_lower_pattern`

Data type: `Optional[String]`

String pattern used to make various components SAP System ID specific. An
lowercase version of the sid will be inserted where this pattern is found.

Default value: '_sid_'

##### `config_sid_upper_pattern`

Data type: `Optional[String]`

String pattern used to make various components SAP System ID specific. An
uppercase version of the sid will be inserted where this pattern is found.

Default value: '_SID_'

##### `packages_backend`

Data type: `Hash[Sap::BackendDatabase, Array[String]]`



Default value: {'db6' => []}

### sap::service

Class: sap::service

This class contain the service configuration for SAP Netweaver

Parameters:   This class has no parameters

Actions:      This class has no actions

Requires:     This class has no requirements

Sample Usage:

### sap::service::cloudconnector

Class: sap::service::cloudconnector

This module contain the service configuration for SAP Cloud Connector

Parameters:   This module has no parameters

Actions:      This module has no actions

Requires:     This module has no requirements

Sample Usage:

### sap::service::router

Class: sap::service::router

This module contain the service configuration for SAP Router

Parameters:   This module has no parameters

Actions:      This module has no actions

Requires:     This module has no requirements

Sample Usage:

## Defined types

### sap::config::mount_point

The sap::config::mount_point class.

#### Parameters

The following parameters are available in the `sap::config::mount_point` defined type.

##### `mount_path`

Data type: `String`

The path to the mountpoint. Note that this is a namevar.

Default value: $name

##### `file_params`

Data type: `Hash[String, String]`

Any valid parameter which could be provided to a File resource type can be
included in this hash. Note that ensure is always set to `directory`.

Default value: []

##### `sid`

Data type: `Optional[String]`

The SID for this mount_point if it is an SID specific entity.

Default value: `undef`

##### `count`

Data type: `Optional[Integer]`

Indicates that this path should be created $count times. The path must
contain the string `_N_` which will be substituted with the count.
For example `/db2/ECP/sapdata_N_`

Default value: `undef`

##### `mount_parameters`

Data type: `Optional[Hash]`

TODO - fill out this section

Default value: {}

##### `required_files`

Data type: `Optional[Array[String]]`

Ordered list of files which this mount point should require.

Default value: []

##### `sid_lower_pattern`

Data type: `Optional[String]`

String pattern used to make various components SAP System ID specific. An
lowercase version of the sid will be inserted where this pattern is found.

Default value: `undef`

##### `sid_upper_pattern`

Data type: `Optional[String]`

String pattern used to make various components SAP System ID specific. An
uppercase version of the sid will be inserted where this pattern is found.

Default value: `undef`

##### `mount_defaults`

Data type: `Optional[Hash]`

Hash of hashes containing mount-type specific defaults. Currently this is
used exclusively to provide default parameters to the NFSv4 client mounts
for SAP related connections.

Default value: {}

### sap::install::package_set

Simple define to manage the installation of a given package set.

#### Parameters

The following parameters are available in the `sap::install::package_set` defined type.

##### `package_list`

Data type: `Array[String]`

An array containing the names of the packages which are to be installed as a
part of this set.

Default value: []

## Functions

### sap::sysctl_calculated_values

Type: Puppet Language

Converts the provided data hash into the corresponding value. This class
performs recursive calls to construct a single value when provided with a
compound series of values.

#### `sap::sysctl_calculated_values(Array[Hash] $data, Integer $index)`

Converts the provided data hash into the corresponding value. This class
performs recursive calls to construct a single value when provided with a
compound series of values.

Returns: `String` The value computed by the calculation process.

##### `data`

Data type: `Array[Hash]`

Array of value hashes. The function will first attempt to call itself for
the next entry in the array and then prepend it's own calculation to
assemble the resulting string.

##### `index`

Data type: `Integer`

Current position in the provided array. The function will call itself for
index + 1 unless the current index is the last element in the array.

### sap::sysctl_line

Type: Puppet Language

This function converts a given entry from a module specific hash provided to
sap::params::config_sysctl into a line of the form <directive> = <value>.
There are three supported line types for this component:
1. `value` - Simply sets the value equal to the entry name
2. `calculated` - Computes the value via the following formula `base * multiplier / divisor`
3. `compound` - Performs a recursive call converting multiple value/calculated sub entries into a single space separated value.

#### `sap::sysctl_line(String $param, Hash[
    String,
    Variant[
      String,
      Integer,
      Array[
        Variant[
          String,
          Hash[
            String,
            Variant[
              Integer,
              String,
            ]
          ]
        ]
      ]
    ]
  ] $data)`

This function converts a given entry from a module specific hash provided to
sap::params::config_sysctl into a line of the form <directive> = <value>.
There are three supported line types for this component:
1. `value` - Simply sets the value equal to the entry name
2. `calculated` - Computes the value via the following formula `base * multiplier / divisor`
3. `compound` - Performs a recursive call converting multiple value/calculated sub entries into a single space separated value.

Returns: `String` A string of the form <directive> = <value>. For example:
`kernel.sem = 1250 256000 100 8192`

##### `param`

Data type: `String`

The name of the kernel parameter this corresponds to. E.g. `kernel.sem` is
the parameter for Linux kernel Semaphore parameters.

##### `data`

Data type: `Hash[
    String,
    Variant[
      String,
      Integer,
      Array[
        Variant[
          String,
          Hash[
            String,
            Variant[
              Integer,
              String,
            ]
          ]
        ]
      ]
    ]
  ]`

Detailed structure containing the components needed to produce the value for
the given parameter.

